{# Liste des offres + pagination #}

{% if offers is not empty %}
  {% for offer in offers %}
    <div class="offer-card">
      <h2>{{ offer.title }}</h2>
      <p><strong>ProposÃ©e par :</strong>
        {{ attribute(offer.owner, 'username') is defined and offer.owner.username ? offer.owner.username : offer.owner.email }}
      </p>
      <p><strong>CompÃ©tence proposÃ©e :</strong> {{ offer.skillOffered.name }}</p>
      <p><strong>CompÃ©tence recherchÃ©e :</strong> {{ offer.skillRequested.name }}</p>
      <p><strong>Description :</strong> {{ offer.description }}</p>
      <p><strong>Status :</strong> {{ offer.status }}</p>

      {% if app.user and app.user.id == offer.owner.id %}
        <form method="post" action="{{ path('offer_delete', {'id': offer.id}) }}" onsubmit="return confirm('Supprimer cette offre ?');">
          <input type="hidden" name="_token" value="{{ csrf_token('delete_offer_' ~ offer.id) }}">
          <button class="btn-delete">ğŸ—‘ Supprimer</button>
        </form>
      {% endif %}
    </div>
  {% endfor %}
{% else %}
  <p>Aucune offre disponible pour le moment.</p>
{% endif %}

{# --- Pagination --- #}
{% if pages is defined and page is defined and pages > 1 %}
  <nav class="pagination" aria-label="Pagination">
    {% set prev = page - 1 %}
    {% if prev < 1 %}
      <span class="disabled">Â« PrÃ©cÃ©dent</span>
    {% else %}
      <a href="{{ path('offer_index', app.request.query.all|merge({'page': prev})) }}" data-page="{{ prev }}">Â« PrÃ©cÃ©dent</a>
    {% endif %}

    {% set start = page - 2 > 1 ? page - 2 : 1 %}
    {% set end = page + 2 < pages ? page + 2 : pages %}

    {% if start > 1 %}
      <a href="{{ path('offer_index', app.request.query.all|merge({'page': 1})) }}" data-page="1">1</a>
      {% if start > 2 %}<span>â€¦</span>{% endif %}
    {% endif %}

    {% for p in start..end %}
      {% if p == page %}
        <span class="active">{{ p }}</span>
      {% else %}
        <a href="{{ path('offer_index', app.request.query.all|merge({'page': p})) }}" data-page="{{ p }}">{{ p }}</a>
      {% endif %}
    {% endfor %}

    {% if end < pages %}
      {% if end < pages - 1 %}<span>â€¦</span>{% endif %}
      <a href="{{ path('offer_index', app.request.query.all|merge({'page': pages})) }}" data-page="{{ pages }}">{{ pages }}</a>
    {% endif %}

    {% set next = page + 1 %}
    {% if next > pages %}
      <span class="disabled">Suivant Â»</span>
    {% else %}
      <a href="{{ path('offer_index', app.request.query.all|merge({'page': next})) }}" data-page="{{ next }}">Suivant Â»</a>
    {% endif %}
  </nav>
{% endif %}
